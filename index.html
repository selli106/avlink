<script>
  // Your Google Sheet CSV URL
  const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSAQeowxkuesoxNXOSvkKq2CyQBqMkYpHprDNXZNw6hXhyYMK0ZXzyLu9zgwMn6B6vn0eozsaOUNy5G/pub?gid=0&single=true&output=csv";
  const googleSheetEditUrl = "https://docs.google.com/spreadsheets/d/1Qj4NF2jjrG7wnpvYDqu6Dvi59GDaIO8pzr_DLWJif-8/edit?gid=0#gid=0";

  let hasOpenedLink = false; // Define the variable

  async function fetchCountdownDate() {
    try {
      const response = await fetch(sheetUrl);
      const data = await response.text();
      const rows = data.split("\n").map(row => row.split(","));
      const countdownRow = rows.find(row => row[0].trim() === "countdown_date");

      if (!countdownRow || countdownRow.length < 2) {
        throw new Error("Countdown date not found.");
      }

      const countdownDate = countdownRow[1].trim();
      startCountdown(countdownDate);
    } catch (error) {
      document.getElementById("countdown").innerText = "Error loading countdown.";
      console.error("Failed to fetch countdown date:", error);
    }
  }

  function startCountdown(dateString) {
    const targetDate = new Date(dateString).getTime();

    function updateCountdown() {
      const now = new Date().getTime();
      const timeLeft = targetDate - now;

      if (timeLeft <= 0) {
        document.getElementById("countdown").innerText = "The countdown has ended!";
        document.getElementById("redirect-button").style.display = "block"; // Show the button

        if (!hasOpenedLink) {
          setTimeout(() => {
            window.open("https://axs8.short.gy/CurrentStream", "_blank");
            hasOpenedLink = true; // Set the flag to true after opening the link
          }, 3000); // Delay for 3 seconds
        }

        return;
      }

      const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
      const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

      document.getElementById("countdown").innerText = `${days}d ${hours}h ${minutes}m ${seconds}s`;
    }

    setInterval(updateCountdown, 1000);
    updateCountdown();
  }

  function accessAdmin() {
    const passcode = prompt("Enter Admin Passcode:");
    if (passcode === "2143") {
      window.open(googleSheetEditUrl, "_blank");
    } else {
      alert("Incorrect Passcode!");
    }
  }

  // Initialize countdown
  fetchCountdownDate();
</script>
